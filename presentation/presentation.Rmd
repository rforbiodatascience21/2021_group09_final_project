---
title: "Final project"
author:
- √Ångela Miranda Segura
- Bernadette Kofoed Christiansen
- Henrik Spiegelhauer
- Ida Frich Hansen
output:
  ioslides_presentation:
    widescreen: false
    transition: slower
    css: slidestyle.css
    df_print: kable
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(kableExtra)
knitr::opts_knit$set(root.dir = here::here()) #root dir for file to project root dir

death_cases <- read_csv("/cloud/project/data/01_death_cases.csv")
recovered_cases <- read_csv("/cloud/project/data/01_recovered_cases.csv")
under_treatment_cases <- read_csv("/cloud/project/data/01_under_treatment_cases.csv")
all_cases<- death_cases %>%
  mutate(birth_date=as.double(birth_date))%>%
  full_join(recovered_cases)%>%
  full_join(under_treatment_cases)
  
full_data<-all_cases%>%
  select(patient_id, gender, education, treatment_data, id_healthcenter, id_treatment_region, hereditary_history)
```


---

<div class="title">Introduction</div>

<div class="up_bar" style="width: 20px"></div><div class="arrow-right" style="margin-left: 20px"></div><br>

The main aim is predicting breast cancer patients chance of survival.  

- [Clean the data](#5)
- [Augment the data](#7)
- [Create some plots](#10)
- Statistical analysis
- Create the prediction tool


# Materials and methods

## Materials {.smaller}

<div class="up_bar" style="width: 40px"></div><div class="arrow-right" style="margin-left: 40px"></div><br>

We are working with a dataset about Breast Cancer that we have obtained from [kaggle website](https://www.kaggle.com/)

This is the dataset we are working with:


```{r dataset}
full_data
```


## Cleaning the data {.smaller}

<div class="up_bar" style="width: 60px"></div><div class="arrow-right" style="margin-left: 60px"></div><br>


```{r}
under_20 <- all_cases%>%
  filter(age<20) %>%
  ggplot(aes(x = age, y = weight)) +
  geom_point()+
  geom_smooth()

under_20
```


## Cleaning the data 

<div class="up_bar" style="width: 80px"></div><div class="arrow-right" style="margin-left: 80px"></div><br>

```{r}
x <- data.frame(BEFORE = c("THE COLUMNS ARE DIFFERENT TYPES","0, 1, 2 VALUES", "NAMES WITH /R/N", "BIRTH DATE WITH 3 CHARACTERS", "BLOOD TYPE 44", "WEIRD WEIGHT/AGE CORRELATIONS", "WOMEN AND MEN"), AFTER = c("EACH COLUMN HAS A CORRECT TYPE","BOLEAN VARIABLES", "CLEAN NAMES", "BIRTH DATE WITH 4 CHARACTERS", "CORRECT BLOOD TYPES ONLY", "ELIMINATING PEOPLE UNDER 20 YEARS OLD AND 35 KG", "ONLY WOMEN"))
x %>% 
 kable() %>%
 kable_styling("striped", full_width = TRUE, font_size = 20) %>%
  kable_classic(full_width = TRUE, html_font = "Cambria") %>%
 column_spec(2, width = "20em") %>%
 row_spec(0, bold = TRUE)
```


## Augmenting the data {.smaller}

<div class="up_bar" style="width: 100px"></div><div class="arrow-right" style="margin-left: 100px"></div><br>

- We have added more informative columns 
- We have changed the type of the columns

## Statistical analysis {.smaller}

<div class="up_bar" style="width: 120px"></div><div class="arrow-right" style="margin-left: 120px"></div><br>

We have created some plots in order to fully understand the data and we have done some statistical analysis like MCA analysis. The plots are shown in the following point: "Results"


# Results {#plots}
## Barchar of categorical variables {.smaller}

<div class="up_bar" style="width: 140px"></div><div class="arrow-right" style="margin-left: 140px"></div><br>

![Analysis barchart categorical](/cloud/project/results/04_analysis_barchart_categorical_education_to_heartmedicine.png){width=50%}![Analysis barchart categorical](/cloud/project/results/04_analysis_barchart_categorical_gallmedicine_to_condition.png){width=50%}

[//]: #  Cultural variables we don't actually need (education, marital_state)
[//]: #  Variables that affect health (medicines, vicious habits) have a great incidence in breast cancer patients 
[//]: #  Early menstrual periods before age 12 and starting menopause after age 55 expose women to hormones longer, raising their risk of getting breast cancer

## Boxplots stratified on conditions {.smaller}

<div class="up_bar" style="width: 160px"></div><div class="arrow-right" style="margin-left: 160px"></div><br>

![Analysis boxplot of age on condition](/cloud/project/results/04_analysis_box_age_on_condition.png){width=50%}![Analysis boxplot of tumor on condition](/cloud/project/results/04_analysis_box_tumor_on_condition.png){width=50%}

<div style="font-size: 0.75em">
- 
</div>

## Boxplots of numerical variables {.background_white .smaller}

<div class="up_bar" style="width: 180px"></div><div class="arrow-right" style="margin-left: 180px"></div><br>

<div style="margin-left:10%">
```{r, out.height="450px"}
knitr::include_graphics("/cloud/project/results/04_analysis_boxplot_numeric_variables.png")
```
</div>


[//]: #  In the data, most of the people is quite young (under 40)
[//]: #  The treatment age is consistent with the age of the patients
[//]: #  The thickness tumor is the most changing variable


## Histograms stratified on condition {.smaller}

<div class="up_bar" style="width: 200px"></div><div class="arrow-right" style="margin-left: 200px"></div><br>

<div style="margin-left:0px">
![Analysis count alcohol on condition](/cloud/project/results/04_analysis_count_alcohol_on_condition.png){width=45%}![Analysis count blood pressure medicine on condition](/cloud/project/results/04_analysis_count_blood_pressure_medicine_on_condition.png){width=45%}

![Analysis count gallbladder medicine on condition](/cloud/project/results/04_analysis_count_gallblader_medicine_on_condition.png){width=45%}![Analysis count heart medicine on condition](/cloud/project/results/04_analysis_count_heart_medicine_on_condition.png){width=45%}
</div>




## Histograms stratified on condition {.smaller}

<div class="up_bar" style="width: 220px"></div><div class="arrow-right" style="margin-left: 220px"></div><br>

![Analysis count on condition](/cloud/project/results/04_analysis_count_radiation_on_condition.png){width=50%}![Analysis count heart medicine on condition](/cloud/project/results/04_analysis_count_smoking_on_condition.png){width=50%}


[//]: #  In all the cases, the recovered fraction is the lowest one.
[//]: #  In the radiation history, the patients who have not suffered from radiation have recovered better than the ones that have had radiation.
[//]: #  In most cases, when having taken medicine the recovery is better.
[//]: #  In most cases, when having taking medicine the death is higher (no sense).
[//]: #  Not drinking alcohol or smoking improves recovery.
[//]: #  When taking alcohol and smoking the death is lower (it doesn't make any sense)
[//]: #  These are absolute values, maybe we should calculate some relative values

## Densitograms stratified on condition {.smaller}

<div class="up_bar" style="width: 240px"></div><div class="arrow-right" style="margin-left: 240px"></div><br>

![Analysis count on condition](/cloud/project/results/05_analysis_ii_densitograms_on_condition.png){width=50%}![Analysis count heart medicine on condition](/cloud/project/results/05_analysis_ii_densitograms_on_tumor.png){width=50%}

[//]: #  Above 40 years old, the possibilities for recovering from a breast cancer are higher
[//]: #  The weight is higher in recovered patients
[//]: #  Patients who died weighted very low (around 25 kg)
[//]: #  In addition, other group of persons who died weighted 75 kg
[//]: #  Thickness of tumor is bigger in patients who died

## Histograms stratified on condition {.smaller}

<div class="up_bar" style="width: 260px"></div><div class="arrow-right" style="margin-left: 260px"></div><br>

```{r, out.width = "750px", out.height="500px"}
knitr::include_graphics("/cloud/project/results/06_analysis_iii_histogram_medicine_tumor.png")
```


[//]: #  When the tumor thickness augments, the medical treatment has more impact

## Heatmap of numerical variables {.smaller}

<div class="up_bar" style="width: 280px"></div><div class="arrow-right" style="margin-left: 280px"></div><br>

```{r, out.width = "750px", out.height="550px"}
knitr::include_graphics("/cloud/project/results/07_heatmap.png")
```


[//]: #  The birth date is totally correlated to the treatment age with negative values
[//]: #  So it is the age, but with positive values
[//]: #  There is no a clear relation between the thickness tumor and the rest of variables

## Dynamic representation of variables {.smaller}

<div class="up_bar" style="width: 300px"></div><div class="arrow-right" style="margin-left: 300px"></div><br>

<div style="margin-left:120px">
```{r, out.width = "550px", out.height="550px"}
knitr::include_graphics("/cloud/project/results/08_gif_birth_age_treatment_age.gif")
```
</div>


[//]: # Along the years, the patients are treated before
[//]: # Along the years, the education levels are more diverse
[//]: #  The age of first giving birth is more or less consistent along the years
[//]: #  When the age of treatment is reduced, the thickness tumor is more diverse




## MCA analysis {.smaller}

<div class="up_bar" style="width: 320px"></div><div class="arrow-right" style="margin-left: 320px"></div><br>

![MCA_contour_conditions](/cloud/project/results/09_MCA_contour_conditions.png){width=50%}![HMCA_contour_tumorType](/cloud/project/results/09_MCA_contour_tumorType.png){width=50%}

<div style="font-size: 0.75em">
- 
</div>

# Discussion {#statistics}
## Discussion {.smaller}

<div class="up_bar" style="width: 360px"></div><div class="arrow-right" style="margin-left: 360px"></div><br>

# Conclusion

## Conclusion {.smaller}

<div class="up_bar" style="width: 400px"></div><div class="arrow-right" style="margin-left: 400px"></div><br>

We have reached the following conclusions

# Bibliography

## Bibliography {.smaller}

<div class="up_bar" style="width: 440px"></div><div class="arrow-right" style="margin-left: 440px"></div><br>

- Breast cancer incidence (invasive) statistics (10 March 2020). [Cancer Research UK](https://www.cancerresearchuk.org/health-professional/cancer-statistics/statistics-by-cancer-type/breast-cancer/incidence-invasive#heading-One)
- Height Percentile Calculator for Men and Women in the United States. [DQYDJ](https://dqydj.com/height-percentile-calculator-for-men-and-women/)
- Weight Gain After Breast Cancer Diagnosis May Be a Bigger Issue Than Thought in Australia (13 March 2020) [BreastCancer.org](https://www.breastcancer.org/research-news/gaining-weight-after-dx-big-problem-in-australia#:~:text=The%20survey%20found%20that%20nearly,diagnosed%20was%20about%20157%20pounds).

[//]: # Incidence of breast cancer at different ages

[//]: # Normal weight of women and explains why we have eliminated women under 20 years old and 35kg (it's not common, but not impossible)

[//]: # There is a gain weight in breast cancer patients, but it is low so we don't take it in consideration

---

<div id="final_box">
<div style="color: rgb(47, 142, 194); font-size: 3em; text-align:center">THANKS</div> 
<div style="color: rgb(91, 175, 222); font-size: 2em; text-align:center"> FOR YOUR ATTENTION</div>
</div>





